(window.webpackJsonp=window.webpackJsonp||[]).push([[35],{156:function(e,n,t){"use strict";t.d(n,"a",(function(){return c})),t.d(n,"b",(function(){return b}));var r=t(0),a=t.n(r),o=a.a.createContext({}),i=function(e){var n=a.a.useContext(o),t=n;return e&&(t="function"==typeof e?e(n):Object.assign({},n,e)),t},c=function(e){var n=i(e.components);return a.a.createElement(o.Provider,{value:n},e.children)};var s="mdxType",l={inlineCode:"code",wrapper:function(e){var n=e.children;return a.a.createElement(a.a.Fragment,{},n)}},p=Object(r.forwardRef)((function(e,n){var t=e.components,r=e.mdxType,o=e.originalType,c=e.parentName,s=function(e,n){var t={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&-1===n.indexOf(r)&&(t[r]=e[r]);return t}(e,["components","mdxType","originalType","parentName"]),p=i(t),b=r,u=p[c+"."+b]||p[b]||l[b]||o;return t?a.a.createElement(u,Object.assign({},{ref:n},s,{components:t})):a.a.createElement(u,Object.assign({},{ref:n},s))}));function b(e,n){var t=arguments,r=n&&n.mdxType;if("string"==typeof e||r){var o=t.length,i=new Array(o);i[0]=p;var c={};for(var l in n)hasOwnProperty.call(n,l)&&(c[l]=n[l]);c.originalType=e,c[s]="string"==typeof e?e:r,i[1]=c;for(var b=2;b<o;b++)i[b]=t[b];return a.a.createElement.apply(null,i)}return a.a.createElement.apply(null,t)}p.displayName="MDXCreateElement"},87:function(e,n,t){"use strict";t.r(n),t.d(n,"frontMatter",(function(){return i})),t.d(n,"rightToc",(function(){return c})),t.d(n,"default",(function(){return p}));t(0);var r=t(156);function a(){return(a=Object.assign||function(e){for(var n=1;n<arguments.length;n++){var t=arguments[n];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])}return e}).apply(this,arguments)}function o(e,n){if(null==e)return{};var t,r,a=function(e,n){if(null==e)return{};var t,r,a={},o=Object.keys(e);for(r=0;r<o.length;r++)t=o[r],n.indexOf(t)>=0||(a[t]=e[t]);return a}(e,n);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)t=o[r],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(a[t]=e[t])}return a}var i={id:"b4a-listener",title:"دریافت جیسون"},c=[],s={rightToc:c},l="wrapper";function p(e){var n=e.components,t=o(e,["components"]);return Object(r.b)(l,a({},s,t,{components:n,mdxType:"MDXLayout"}),Object(r.b)("p",null,"شما میتوانید از طریق پنل برای اپلیکیشن خود اطلاعات دلخواه در قالب جیسون (JSON) ارسال کنید. برای اینکه بتوانید از این اطلاعات در اپلیکیشن خود استفاده کنید مراحل زیر را انجام دهید."),Object(r.b)("ul",null,Object(r.b)("li",{parentName:"ul"},Object(r.b)("p",{parentName:"li"},"در منوی نرم‌افزار\n",Object(r.b)("strong",{parentName:"p"},"B4A"),"\nگزینه‌ی\n",Object(r.b)("inlineCode",{parentName:"p"},"Project -> Add New Module -> Service Module"),"\nرا انتخاب کنید و یک سرویس جدید بسازید. از شما خواسته خواهد شد که نام سرویس را وارد کنید، ما فرض می‌کنیم که نام سرویس\n",Object(r.b)("inlineCode",{parentName:"p"},"MyJsonReceiver"),"\nهست ولی شما می‌توانید نام دلخواه خود را انتخاب کنید.")),Object(r.b)("li",{parentName:"ul"},Object(r.b)("p",{parentName:"li"},"فایل جدیدی با نام سرویسی که ساختید ایجاد خواهد شد. محتویات فایل را با متن زیر جایگزین کنید.\nهر بار که اعلان جدیدی حاوی اطلاعات جیسون دریافت شود، تابع\n",Object(r.b)("inlineCode",{parentName:"p"},"MessageReceived"),"\nصدا زده خواهد شود. شما می‌توانید در این تابع عملیات مورد نظر خود را برای آن پیغام انجام دهید."))),Object(r.b)("pre",null,Object(r.b)("code",a({parentName:"pre"},{className:"language-js"}),'\nSub Process_Globals\n    Dim PusheUtil As PusheB4AUtil\nEnd Sub\n\nSub Service_Start (pIntent As Intent)\n    If pIntent.Action == "co.ronash.pushe.RECEIVE" Then\n        Dim JsonMsg As String\n        JsonMsg = PusheUtil.getPusheJsonMsg(pIntent)\n        If JsonMsg <> "" Then\n            MessageReceived(JsonMsg)\n        End If\n    End If\n    Service.StopAutomaticForeground\nEnd Sub\n\nSub MessageReceived (JsonMsg As String)\n    Log("Received Json Message")\n    Log(JsonMsg)\n\n    \' Process json message here ...\nEnd Sub\n')),Object(r.b)("ul",null,Object(r.b)("li",{parentName:"ul"},"از طریق منوی\n",Object(r.b)("inlineCode",{parentName:"li"},"Project -> Manifest Editor"),"\nتنظیمات منیفست پروژه را باز کنید و متن زیر را به آن اضافه کنید. توجه داشته باشید که عبارت\n",Object(r.b)("inlineCode",{parentName:"li"},"MyJsonReceiver"),"\nرا با نام سرویس خود جایگزین کنید.")),Object(r.b)("pre",null,Object(r.b)("code",a({parentName:"pre"},{className:"language-xml"}),'AddServiceText(MyJsonReceiver,\n<intent-filter>\n    <action android:name="co.ronash.pushe.RECEIVE"/>\n</intent-filter>\n)\n')),Object(r.b)("p",null,"ورودی که به تابع\n",Object(r.b)("inlineCode",{parentName:"p"},"MessageReceived"),"\nداده می‌شود به صورت یک\n",Object(r.b)("inlineCode",{parentName:"p"},"String"),"\nحاوی اطلاعات جیسون شماست. برای استفاده از ان احتمالا بخواهید ابتدا آن را به یک\n",Object(r.b)("inlineCode",{parentName:"p"},"Map"),"\nتبدیل کنید. نحوه‌ی انجام این کار را با یک مثال توضیح می‌دهیم."),Object(r.b)("p",null,"فرض کنید جیسونی به صورت مقابل فرستاده‌اید:"),Object(r.b)("pre",null,Object(r.b)("code",a({parentName:"pre"},{className:"language-json"}),'{\n    "titr": "تیتر",\n    "matn": "متن"\n}\n')),Object(r.b)("p",null,"می‌خواهیم با دریافت این پیغام، یک\nToast\nحاوی تیتر و متن داده شده به کاربر نشان دهیم. برای این کار ابتدا لازم است که کتابخانه‌ی\n",Object(r.b)("inlineCode",{parentName:"p"},"JSON"),"\nرا در پنجره‌ی\n",Object(r.b)("inlineCode",{parentName:"p"},"Libraries Manager"),"\nفعال کنید. سپس تابع\n",Object(r.b)("inlineCode",{parentName:"p"},"MessageReceived"),"\nرا به صورت زیر پیاده‌سازی می‌کنیم."),Object(r.b)("pre",null,Object(r.b)("code",a({parentName:"pre"},{className:"language-js"}),'\nSub MessageReceived (jsonStr As String)\n    Dim jsonParser As JSONParser\n    Dim jsonObject As Map\n    Dim title as String\n    Dim content as String\n\n    Try\n        jsonParser.Initialize(jsonStr)\n        jsonObject = jsonParser.NextObject\n        title = jsonObject.Get("titr")\n        content = jsonObject.Get("matn")\n        ToastMessageShow(title & ":" & content , True)\n    Catch\n        Log(LastException)\n    End Try\nEnd Sub\n')))}p.isMDXComponent=!0}}]);