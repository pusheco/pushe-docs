(window.webpackJsonp=window.webpackJsonp||[]).push([[24],{297:function(e,n,t){"use strict";t.d(n,"a",(function(){return s})),t.d(n,"b",(function(){return b}));var r=t(0),a=t.n(r),c=a.a.createContext({}),o=function(e){var n=a.a.useContext(c),t=n;return e&&(t="function"==typeof e?e(n):Object.assign({},n,e)),t},s=function(e){var n=o(e.components);return a.a.createElement(c.Provider,{value:n},e.children)};var l="mdxType",i={inlineCode:"code",wrapper:function(e){var n=e.children;return a.a.createElement(a.a.Fragment,{},n)}},p=Object(r.forwardRef)((function(e,n){var t=e.components,r=e.mdxType,c=e.originalType,s=e.parentName,l=function(e,n){var t={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&-1===n.indexOf(r)&&(t[r]=e[r]);return t}(e,["components","mdxType","originalType","parentName"]),p=o(t),b=r,u=p[s+"."+b]||p[b]||i[b]||c;return t?a.a.createElement(u,Object.assign({},{ref:n},l,{components:t})):a.a.createElement(u,Object.assign({},{ref:n},l))}));function b(e,n){var t=arguments,r=n&&n.mdxType;if("string"==typeof e||r){var c=t.length,o=new Array(c);o[0]=p;var s={};for(var i in n)hasOwnProperty.call(n,i)&&(s[i]=n[i]);s.originalType=e,s[l]="string"==typeof e?e:r,o[1]=s;for(var b=2;b<c;b++)o[b]=t[b];return a.a.createElement.apply(null,o)}return a.a.createElement.apply(null,t)}p.displayName="MDXCreateElement"},68:function(e,n,t){"use strict";t.r(n),t.d(n,"frontMatter",(function(){return o})),t.d(n,"rightToc",(function(){return s})),t.d(n,"default",(function(){return p}));t(0);var r=t(297);function a(){return(a=Object.assign||function(e){for(var n=1;n<arguments.length;n++){var t=arguments[n];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])}return e}).apply(this,arguments)}function c(e,n){if(null==e)return{};var t,r,a=function(e,n){if(null==e)return{};var t,r,a={},c=Object.keys(e);for(r=0;r<c.length;r++)t=c[r],n.indexOf(t)>=0||(a[t]=e[t]);return a}(e,n);if(Object.getOwnPropertySymbols){var c=Object.getOwnPropertySymbols(e);for(r=0;r<c.length;r++)t=c[r],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(a[t]=e[t])}return a}var o={id:"studio-fcm",title:"استفاده‌ی همزمان با FCM"},s=[{value:"غیر فعال کردن سرویس FCM پوشه",id:"غیر-فعال-کردن-سرویس-fcm-پوشه",children:[]},{value:"ایجاد سرویس FCM دلخواه خود",id:"ایجاد-سرویس-fcm-دلخواه-خود",children:[]},{value:"رساندن پیغام‌ها و رویداد‌ها به پوشه",id:"رساندن-پیغامها-و-رویدادها-به-پوشه",children:[]}],l={rightToc:s},i="wrapper";function p(e){var n=e.components,t=c(e,["components"]);return Object(r.b)(i,a({},l,t,{components:n,mdxType:"MDXLayout"}),Object(r.b)("blockquote",null,Object(r.b)("p",{parentName:"blockquote"},"نسخه‌ی 1.6 به بعد")),Object(r.b)("p",null,"پوشه برای دریافت اعلان از سرویس FCM(Firebase Cloud Messaging) گوگل استفاده می‌کند. در صورتی که پوشه تنها سرویسی در اپلیکیشن شما باشد که از این سرویس استفاده می‌کند، با دنبال کردن همان مراحلی که در قسمت راه‌اندازی توضیح داده شد همه چیز به درستی کار خواهد کرد و نیاز به انجام کار اضافه‌ای نیست.\nولی در مواردی که غیر از پوشه سرویس دیگری نیز بخواهد از\nFCM\nاستفاده کند، مثلا اگر خود شما بخواهید مستقیما از\nFirebase\nاستفاده کنید و پیغام‌های\nFCM\nرا دریافت کنید، تداخل پیش خواهد آمد، چرا که در هر اپلیکیشن تنها یک سرویس گوش‌دهنده به پیغام‌های\nFCM\nمی‌تواند وجود داشته باشد. اگر بیش از یک سرویس گوش‌دهنده تعریف شود، پیغام‌هایی که به اپلیکیشن می‌رسند به صورت تصادفی تنها به دست یکی از این سرویس‌ها خواهد رسید و این باعث مختل شدن کار برنامه می‌شود."),Object(r.b)("p",null,"برای رفع این مشکل لازم است مراحل زیر را در راه اندازی طی کنید:"),Object(r.b)("ol",null,Object(r.b)("li",{parentName:"ol"},"سرویس گوش دهنده FCM پوشه را غیر فعال کنید"),Object(r.b)("li",{parentName:"ol"},"سرویس گوش دهنده FCM خود را فعال کنید"),Object(r.b)("li",{parentName:"ol"},"با دریافت پیغام‌های FCM و رخ دادن رویداد‌های مربوط به آن در سرویس خود، پوشه را مطلع کنید")),Object(r.b)("p",null,"با طی کردن این مراحل، تنها گوش دهنده به پیغام‌های\nFCM\nگوش دهنده تعریف شده شما خواهد بود که همه‌ی پیغام‌های\nFCM\nرا دریافت خواهد کرد و پیغام‌های مربوط به پوشه را به کتابخانه‌ی پوشه تحویل می‌دهد."),Object(r.b)("p",null," در ادامه نحوه اعمال این مراحل را قدم به قدم توضیح می‌دهیم:"),Object(r.b)("h2",{id:"غیر-فعال-کردن-سرویس-fcm-پوشه"},"غیر فعال کردن سرویس FCM پوشه"),Object(r.b)("p",null,"برای غیر فعال کردن سرویس\nFCM\nپوشه، عبارت زیر را در تگ\n",Object(r.b)("inlineCode",{parentName:"p"},"<application>"),"\nفایل منیفست خود بگذارید:"),Object(r.b)("pre",null,Object(r.b)("code",a({parentName:"pre"},{className:"language-xml"}),'<service\n    android:name="co.pushe.plus.messaging.fcm.FcmService" \n    tools:node="remove" />\n')),Object(r.b)("p",null,"در صورتی که با پیغام خطا مواجه شدید بررسی کنید که عبارت\n",Object(r.b)("inlineCode",{parentName:"p"},'xmlns:tools="http://schemas.android.com/tools"'),"\nدر پارامتر‌های تگ\n",Object(r.b)("inlineCode",{parentName:"p"},"<manifest>"),"\nابتدای فایل، وجود داشته باشد، به این شکل:"),Object(r.b)("pre",null,Object(r.b)("code",a({parentName:"pre"},{className:"language-xml"}),'<manifest xmlns:android="http://schemas.android.com/apk/res/android"\n    xmlns:tools="http://schemas.android.com/tools"\n    package="..."/>\n')),Object(r.b)("h2",{id:"ایجاد-سرویس-fcm-دلخواه-خود"},"ایجاد سرویس FCM دلخواه خود"),Object(r.b)("p",null,"در صورتی که از قبل سرویس\nFCM\nبرای برنامه‌ی خود ایجاد کرده‌اید می‌توانید از این مرحله بگذرید."),Object(r.b)("p",null,"یک کلاس جدید بسازید که از کلاس\n",Object(r.b)("inlineCode",{parentName:"p"},"FirebaseMessagingService"),"\nارث می‌برد. در مثال زیر اسم کلاس را\n",Object(r.b)("inlineCode",{parentName:"p"},"MyFcmService"),"\nگذاشتیم ولی شما می‌توانید اسم دلخواه خود را استفاده کنید."),Object(r.b)("pre",null,Object(r.b)("code",a({parentName:"pre"},{className:"language-java"}),"\npublic class MyFcmService extends FirebaseMessagingService {\n\n}\n\n")),Object(r.b)("p",null,"سرویس جدید را با گذاشتن عبارت زیر در تگ\n",Object(r.b)("inlineCode",{parentName:"p"},"<application>"),"\nفایل منیفست خود فعال کنید. توجه داشته باشید که نام کلاس را با نام کلاس تعریف شده خود جایگزین کنید."),Object(r.b)("pre",null,Object(r.b)("code",a({parentName:"pre"},{className:"language-xml"}),'<service android:name=".MyFcmService">\n    <intent-filter>\n        <action android:name="com.google.firebase.MESSAGING_EVENT" />\n    </intent-filter>\n</service>\n')),Object(r.b)("h2",{id:"رساندن-پیغامها-و-رویدادها-به-پوشه"},"رساندن پیغام‌ها و رویداد‌ها به پوشه"),Object(r.b)("p",null,"در کلاس تعریف شده در مرحله قبل، تابع‌های زیر را به همراه کد داخل آن‌ها پیاده‌سازی کنید:"),Object(r.b)("pre",null,Object(r.b)("code",a({parentName:"pre"},{className:"language-java"}),"\npublic class MyFcmService extends FirebaseMessagingService {\n\n    @Override\n    public void onMessageReceived(RemoteMessage remoteMessage) {\n        if (Pushe.getFcmHandler().onMessageReceived(remoteMessage)) {\n            // Message is for Pushe\n            return;\n        }\n        super.onMessageReceived(remoteMessage);\n\n        // Handle Firebase message\n    }\n\n    @Override\n    public void onNewToken(String s) {\n        Pushe.getFcmHandler().onNewToken(s);\n        super.onNewToken(s);\n\n        // Token is refreshed\n    }\n\n    @Override\n    public void onMessageSent(String s) {\n        Pushe.getFcmHandler().onMessageSent(s);\n        super.onMessageSent(s);\n\n        // Message sent\n    }\n\n    @Override\n    public void onDeletedMessages() {\n        Pushe.getFcmHandler().onDeletedMessages();\n        super.onDeletedMessages();\n\n        // Message was deleted\n    }\n\n    @Override\n    public void onSendError(String s, Exception e) {\n        Pushe.getFcmHandler().onSendError(s, e);\n        super.onSendError(s, e);\n\n        // Error sent\n    }\n}\n\n")),Object(r.b)("p",null,"هر بار که یک پیغام\nFCM\nبه برنامه شما می‌رسد، تابع\n",Object(r.b)("inlineCode",{parentName:"p"},"onMessageReceived"),"\nکلاس شما صدا زده می‌شود. همانطور که در مثال بالا مشاهده می‌کنید در پیاده‌سازی این تابع، شما با استفاده از عبارت زیر پوشه را از دریافت پیغام مطلع می‌کنید:"),Object(r.b)("pre",null,Object(r.b)("code",a({parentName:"pre"},{className:"language-java"}),"Pushe.getFcmHandler().onMessageReceived(remoteMessage)\n")),Object(r.b)("p",null,"با این کار پیغام به دست پوشه نیز می‌رسد و اگر پیغام مربوط به کتابخانه‌ی پوشه باشد عملیات لازم بر روی آن انجام می‌شود. در صورتی که پیغام مربوط به پوشه باشد عبارت بالا مقدار\n",Object(r.b)("inlineCode",{parentName:"p"},"true"),"\nبر می‌گرداند و شما نیازی نیست عملیات بیشتری روی این پیغام انجام دهید. در صورتی که از عبارت بالا مقدار\n",Object(r.b)("inlineCode",{parentName:"p"},"false"),"\nگرفتید به این معنی است که پیغام مربوط به پوشه نیست و شما باید بسته به نیاز خود عملیات مورد نظر را برای آن انجام دهید."),Object(r.b)("p",null,"سایر توابع کلاس تعریف شده، زمان رخ دادن رویداد‌های مختلف مربوط به\nFCM\nصدا زده می‌شوند. همانطور که در مثال بالا نشان داده شده، نیاز است که شما هنگام رخ دادن این رویدادها با صدا زدن تابع مربوطه از کتابخانه‌ی پوشه، پوشه را از رخ دادن این رویدادها مطلع کنید."))}p.isMDXComponent=!0}}]);