(window.webpackJsonp=window.webpackJsonp||[]).push([[96],{194:function(e,n,t){"use strict";t.r(n),t.d(n,"frontMatter",(function(){return c})),t.d(n,"rightToc",(function(){return i})),t.d(n,"default",(function(){return p}));t(0);var r=t(297);function a(){return(a=Object.assign||function(e){for(var n=1;n<arguments.length;n++){var t=arguments[n];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])}return e}).apply(this,arguments)}function o(e,n){if(null==e)return{};var t,r,a=function(e,n){if(null==e)return{};var t,r,a={},o=Object.keys(e);for(r=0;r<o.length;r++)t=o[r],n.indexOf(t)>=0||(a[t]=e[t]);return a}(e,n);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)t=o[r],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(a[t]=e[t])}return a}var c={id:"rn-fcm",title:"استفاده‌ی همزمان با FCM"},i=[{value:"مشکل استفاده‌ از دو سرویس FCM",id:"مشکل-استفاده-از-دو-سرویس-fcm",children:[]},{value:"رفع مشکل اختلال سرویس‌ها",id:"رفع-مشکل-اختلال-سرویسها",children:[{value:"حذف سرویس ها و ساخت سرویس جدید",id:"حذف-سرویس-ها-و-ساخت-سرویس-جدید",children:[]}]}],s={rightToc:i},l="wrapper";function p(e){var n=e.components,t=o(e,["components"]);return Object(r.b)(l,a({},s,t,{components:n,mdxType:"MDXLayout"}),Object(r.b)("blockquote",null,Object(r.b)("p",{parentName:"blockquote"},"تمام نسخه‌ها")),Object(r.b)("blockquote",null,Object(r.b)("p",{parentName:"blockquote"},Object(r.b)("strong",{parentName:"p"},"نکته"),":‌ در این بخش بایستی کد به زبان نیتیو اندروید نوشته شود.")),Object(r.b)("h2",{id:"مشکل-استفاده-از-دو-سرویس-fcm"},"مشکل استفاده‌ از دو سرویس FCM"),Object(r.b)("p",null,"پوشه برای دریافت و ارسال پیام‌های خود از سرویس FCM(Firebase cloud messaging) گوگل استفاده می‌کند.\nدر صورتی که قصد دارید در کنار پوشه از سرویس دیگری مانند فایربیس و یا هر سرویسی که پایه‌ی آن fcm است، استفاده‌کنید باید در نظر داشته‌باشید که ",Object(r.b)("strong",{parentName:"p"},"در هربرنامه فقط یک سرویس برپایه‌ی fcm می‌تواند باشد")," و در صورت وجود بیش از یک سرویس، ممکن است در کار آنها اختلال ایجاد کند."),Object(r.b)("h2",{id:"رفع-مشکل-اختلال-سرویسها"},"رفع مشکل اختلال سرویس‌ها"),Object(r.b)("p",null,"برای جلوگیری از ایجاد اخلال ",Object(r.b)("strong",{parentName:"p"},"باید یک سرویس طراحی کنید و پیام‌های سایر سرویس‌ها را جداسازی کنید"),". در این صورت ارجاع پیام به سرویس مربوطه بایستی دستی انجام شود تا هر سرویس بتواند جدا از سرویس دیگری کار خود را انجام دهد."),Object(r.b)("h3",{id:"حذف-سرویس-ها-و-ساخت-سرویس-جدید"},"حذف سرویس ها و ساخت سرویس جدید"),Object(r.b)("p",null,"در این بخش باید تگ‌های سرویس پوشه و لایبرری دیگر که از فایربیس استفاده می‌کند (مثل خود فایربیس در ReactNative) را از مانیفست نهایی پاک کنید و تگ سرویس خود را قرار دهید."),Object(r.b)("p",null,"فایل ",Object(r.b)("inlineCode",{parentName:"p"},"AndroidManifest.xml")," خود را باز کرده و در داخل تگ ",Object(r.b)("inlineCode",{parentName:"p"},"application")," در قبل یا بعد از توکن پوشه خطوط زیر را اضافه‌کنید:"),Object(r.b)("pre",null,Object(r.b)("code",a({parentName:"pre"},{className:"language-xml"}),'<service\n   android:name="co.ronash.pushe.fcm.FcmService" \n   tools:node="remove" />\n   \n\x3c!-- Add your own service name instead of this , if you are not using firebase --\x3e\n<service\n   android:name="com.reactlibrary.RNPusheNotificationService" \n   tools:node="remove" />\n')),Object(r.b)("blockquote",null,Object(r.b)("p",{parentName:"blockquote"},"دقت‌کنید که یکی از سرویس‌ها پوشه است و سرویس دیگری مربوط به پلاگین دیگری‌است که از فایربیس استفاده می‌کند (در اینجا پلاگین فایربیس ReactNative).")),Object(r.b)("p",null,"پس از پاک‌کردن سرویس‌های در معرض مشکل، سرویسی ایجاد کنید که از سرویس دیگر (در اینجا سرویس فایربیس ReactNative) ارث‌بری می‌کند؛ مثلا سرویس ",Object(r.b)("inlineCode",{parentName:"p"},"FirebaseMessagingService")," برای فایربیس. پس از ساختن سرویس کد سرویس را بصورت زیر تغییر دهید:"),Object(r.b)("blockquote",null,Object(r.b)("p",{parentName:"blockquote"},"بایستی در آدرس ",Object(r.b)("inlineCode",{parentName:"p"},"android/src/main/java/")," به داخل فولدر پکیج خودتان بروید و در آنجا یک فایل جاوا ایجاد کنید. توصیه می‌شود از ",Object(r.b)("strong",{parentName:"p"},"Android studio")," برای این کار استفاده کنید.")),Object(r.b)("pre",null,Object(r.b)("code",a({parentName:"pre"},{className:"language-java"}),"public class MyFCMService extends FirebaseMessagingService {\n    @Override\n    public void onNewToken(String s) {\n        co.ronash.pushe.Pushe.getFcmHandler(this).onNewToken(s);\n        super.onNewToken(s);\n    }\n    @Override\n    public void onDeletedMessages() {\n        co.ronash.pushe.Pushe.getFcmHandler(this).onDeletedMessages();\n        super.onDeletedMessages();\n    }\n    @Override\n    public void onSendError(String s, Exception e) {\n        co.ronash.pushe.Pushe.getFcmHandler(this).onSendError(s, e);\n        super.onSendError(s, e);\n    }\n    @Override\n    public void onMessageSent(String s) {\n        co.ronash.pushe.Pushe.getFcmHandler(this).onMessageSent(s);\n        super.onMessageSent(s);\n    }\n    @Override\n    public void onMessageReceived(RemoteMessage remoteMessage) {\n        if (!co.ronash.pushe.Pushe\n            .getFcmHandler(this)\n            .onMessageReceived(remoteMessage)) {\n            // It is for fire base, otherwise the condition will handle the message for Pushe\n            super.onMessageReceived(remoteMessage);\n        }\n    }\n}\n")),Object(r.b)("p",null,"و در آخر سرویس خود را به مانیفست اضافه نمایید:"),Object(r.b)("pre",null,Object(r.b)("code",a({parentName:"pre"},{className:"language-xml"}),'<service android:name=".MyFcmService">\n    <intent-filter>\n        <action android:name="com.google.firebase.MESSAGING_EVENT" />\n    </intent-filter>\n</service>\n')))}p.isMDXComponent=!0},297:function(e,n,t){"use strict";t.d(n,"a",(function(){return i})),t.d(n,"b",(function(){return u}));var r=t(0),a=t.n(r),o=a.a.createContext({}),c=function(e){var n=a.a.useContext(o),t=n;return e&&(t="function"==typeof e?e(n):Object.assign({},n,e)),t},i=function(e){var n=c(e.components);return a.a.createElement(o.Provider,{value:n},e.children)};var s="mdxType",l={inlineCode:"code",wrapper:function(e){var n=e.children;return a.a.createElement(a.a.Fragment,{},n)}},p=Object(r.forwardRef)((function(e,n){var t=e.components,r=e.mdxType,o=e.originalType,i=e.parentName,s=function(e,n){var t={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&-1===n.indexOf(r)&&(t[r]=e[r]);return t}(e,["components","mdxType","originalType","parentName"]),p=c(t),u=r,b=p[i+"."+u]||p[u]||l[u]||o;return t?a.a.createElement(b,Object.assign({},{ref:n},s,{components:t})):a.a.createElement(b,Object.assign({},{ref:n},s))}));function u(e,n){var t=arguments,r=n&&n.mdxType;if("string"==typeof e||r){var o=t.length,c=new Array(o);c[0]=p;var i={};for(var l in n)hasOwnProperty.call(n,l)&&(i[l]=n[l]);i.originalType=e,i[s]="string"==typeof e?e:r,c[1]=i;for(var u=2;u<o;u++)c[u]=t[u];return a.a.createElement.apply(null,c)}return a.a.createElement.apply(null,t)}p.displayName="MDXCreateElement"}}]);